<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
    <title id="pageTitle">Invoices</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"/>
    <style>
        .table-responsive {
            overflow-x: auto;
        }
        .btn-group .btn {
            margin: 0 2px;
        }
    </style>
</head>
<body>
<nav th:replace="fragments/navHeader :: navbar"></nav>
<div class="container my-4">
    <h2 class="mb-3 text-center title">Invoices List</h2>

    <!-- Success/Error Messages -->
    <h2 class="mb-3 text-center error" th:if="${not #strings.isEmpty(messageError)}" th:text="${messageError}">Error message</h2>
    <h2 class="mb-3 text-center success" th:if="${not #strings.isEmpty(messageSuccess)}" th:text="${messageSuccess}">Success message</h2>
    <p th:if="${not #strings.isEmpty(message)}" th:text="${message}" class="text-center"></p>

    <!-- Search Forms -->
    <div class="row mb-3">
        <div class="col-md-6">
            <form th:object="${invoice}" th:action="@{/partinvoice/search/customer}" method="post" class="form-inline">
                <div class="input-group">
                    <input type="text" class="form-control" th:field="*{custName}" placeholder="Search by customer name"/>
                    <button type="submit" class="btn btn-primary">Search Customer</button>
                </div>
            </form>
        </div>
        <div class="col-md-6">
            <form th:object="${invoice}" th:action="@{/partinvoice/search/vehicle}" method="post" class="form-inline">
                <div class="input-group">
                    <input type="text" class="form-control" th:field="*{vehicle}" placeholder="Search by vehicle"/>
                    <button type="submit" class="btn btn-primary">Search Vehicle</button>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive">
        <table id="theData" class="table table-striped table-hover align-middle display">
            <thead class="table-dark text-center">
            <tr>
                <th>Invoice ID</th>
                <th>Transaction Date</th>
                <th>Customer Name</th>
                <th>Vehicle</th>
                <th>Part Number</th>
                <th>Part Qty</th>
                <th>Total Cost</th>
                <th>Options</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="invoice : ${invoices}">
                <td th:text="${invoice.invoiceID}"></td>
                <td th:text="${invoice.transactionDate}"></td>
                <td th:text="${invoice.custName}"></td>
                <td th:text="${invoice.vehicle}"></td>
                <td th:text="${invoice.partNumber}"></td>
                <td th:text="${invoice.partQuantity}"></td>
                <td th:text="${#numbers.formatCurrency(invoice.totalCost)}"></td>
                <td class="text-center">
                    <div class="btn-group" role="group">
                        <a th:href="@{/partinvoice/edit/{id}(id=${invoice.invoiceID})}"
                           class="btn btn-sm btn-outline-primary" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a th:href="@{/partinvoice/delete/{id}(id=${invoice.invoiceID})}"
                           class="btn btn-sm btn-outline-danger" title="Delete">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>

<!--            &lt;!&ndash; Message when no data &ndash;&gt;-->
<!--            <tr th:if="${#lists.isEmpty(invoices)}">-->
<!--                <td colspan="8" class="text-center text-muted py-4">-->
<!--                    No invoices found.-->
<!--                </td>-->
<!--            </tr>-->
            </tbody>
        </table>
    </div>

    <!-- Add new button -->
    <div class="text-center mt-3">
        <a th:href="@{/partinvoice/add}" class="btn btn-success">
            <i class="fas fa-plus"></i> Add New Invoice
        </a>
    </div>
</div>
<footer th:replace="fragments/footer :: footer"></footer>

<!-- DataTables JavaScript -->
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

<script>
    // Proper DataTables initialization
    $(document).ready(function () {
        // Check if DataTable is already initialized and destroy it first
        if ($.fn.DataTable.isDataTable('#theData')) {
            $('#theData').DataTable().destroy();
        }

        // Initialize DataTable with opt ions
        var table = $('#theData').DataTable({
            "pageLength": 10,
            "responsive": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "paging": true,
            "language": {
                "emptyTable": "No invoices found"
            }
        });
    });

    function confirmDelete(invoiceId) {
        if (confirm('Are you sure you want to delete invoice ' + invoiceId + '? This action cannot be undone.')) {
            window.location.href = '/partinvoice/delete/' + invoiceId;
        }
    }
</script>
</body>
</html>